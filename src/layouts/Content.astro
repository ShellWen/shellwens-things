---
import Header from '../components/Header.astro'
import Footer from '../components/Footer.astro'
import FormattedDate from '../components/FormattedDate.astro'
import BaseLayout from './BaseLayout.astro'

import Comments from '@/components/Comments.svelte'
import TopToc from '@/components/toc/TopToc.astro'
import { SITE_TITLE } from '@/consts'
import { Icon } from 'astro-icon/components'
import type { MarkdownHeading } from '@astrojs/markdown-remark'

type Props = {
  slug: string
  title: string
  description: string
  pubDate: Date
  updatedDate: Date
  headings: MarkdownHeading[]
  minutesRead: string
}

const { slug, title, description, pubDate, updatedDate, headings, minutesRead } = Astro.props
const term = `${title} | ${slug}`
---

<BaseLayout title={`${title} | ${SITE_TITLE}`} description={description} pubDate={pubDate}>
  <Header slot="header" />
  <main slot="body" data-pagefind-body>
    <article id="article-content" class="w-full">
      <header class="mx-auto flex w-full max-w-prose flex-col items-center px-4 pt-8 pb-4 text-center sm:pt-12">
        <h1
          id="article-title"
          class="text-3xl font-bold sm:text-4xl"
          transition:name={`title-${slug}`}
          data-pagefind-meta="title"
        >
          {title}
        </h1>
        <div id="article-metadata" class="mt-4 flex flex-wrap justify-center gap-4 text-sm opacity-80">
          <div
            id="pub-date"
            transition:name={`pub-date-${slug}`}
            class="tooltip flex items-center gap-1"
            data-tip="æœ€åˆå‘å¸ƒæ—¥æœŸ"
          >
            <Icon name="material-symbols:calendar-today" />
            <FormattedDate date={pubDate} />
          </div>
          <div
            id="updated-date"
            transition:name={`updated-date-${slug}`}
            class="tooltip flex items-center gap-1"
            data-tip="ä¸Šæ¬¡æ›´æ–°æ—¥æœŸ"
          >
            <Icon name="material-symbols:history" />
            <FormattedDate date={updatedDate} />
          </div>
          <div
            id="minutes-read"
            transition:name={`minutes-read-${slug}`}
            class="tooltip flex items-center gap-1"
            data-tip="é¢„è®¡é˜…è¯»æ—¶é—´"
          >
            <Icon name="material-symbols:timer" />
            {minutesRead}
          </div>
        </div>
      </header>
      <div id="article-body" class="mx-auto prose w-full p-4">
        <div id="article-main" class="mx-auto">
          {
            description && (
              <p id="article-description" class="mb-0 text-center italic" transition:name={`description-${slug}`}>
                {description}
              </p>
            )
          }
          {headings.length !== 0 && <TopToc id="table-of-contents" headings={headings} class="py-4" />}
          <slot />
          <style is:global>
            @reference "tailwindcss";

            h1,
            h2,
            h3,
            h4,
            h5,
            h6 {
              --link-opacity: 0%;
              &:hover {
                --link-opacity: 100%;
              }
            }
            .icon-link {
              @apply absolute opacity-(--link-opacity) transition-opacity;
            }
            .icon-link::before {
              @apply -ml-6 inline-block size-0 text-lg content-['ğŸ”—'];
            }

            /* @media (prefers-color-scheme: dark) {
              .astro-code,
              .astro-code span {
                color: var(--shiki-dark) !important;
                background-color: var(--shiki-dark-bg) !important;
                font-style: var(--shiki-dark-font-style) !important;
                font-weight: var(--shiki-dark-font-weight) !important;
                text-decoration: var(--shiki-dark-text-decoration) !important;
              }
            } */
            /* Use @apply to compatible with Tailwind CSS dark mode */
            .astro-code,
            .astro-code span {
              @apply dark:bg-(--shiki-dark-bg)! dark:font-(--shiki-dark-font-weight)! dark:text-(--shiki-dark)! dark:[font-style:var(--shiki-dark-font-style)]! dark:[text-decoration:var(--shiki-dark-text-decoration)]!;
            }
          </style>
        </div>
        <div id="copyright-notice" class="divider">ç‰ˆæƒå£°æ˜</div>
        <p id="copyright-text" class="mx-auto">
          æœ¬é¡µé¢å†…å®¹ï¼Œé™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a
            href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans"
            target="_blank"
            class="link">CC BY-NC-SA 4.0 Deed</a
          > åè®®æˆæƒã€‚<div class="divider" id="comments-area-divider">è¯„è®ºåŒº</div>
          <Comments id="comments-area" term={term} client:idle client:only="svelte" />
          <noscript id="comments-area-noscript">
            è¯„è®ºåŒºéœ€è¦ JavaScript æ”¯æŒï¼Œä½†æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒ JavaScript æˆ– JavaScript è¢«ç¦ç”¨äº†ã€‚
            <br />
            è¯·å¼€å¯ JavaScript æˆ–è€…ä½¿ç”¨æ”¯æŒ JavaScript çš„æµè§ˆå™¨ã€‚
          </noscript>
        </p>
      </div>
    </article>
    <Footer slot="footer" />
  </main>
</BaseLayout>
