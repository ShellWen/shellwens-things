---
import Header from '../components/Header.astro'
import Footer from '../components/Footer.astro'
import FormattedDate from '../components/FormattedDate.astro'
import BaseLayout from './BaseLayout.astro'

import Comments from '@/components/Comments'
import { SITE_TITLE } from '@/consts'

type Props = {
  slug: string
  title: string
  description: string
  pubDate: Date
  updatedDate?: Date | undefined
  heroImage?: string | undefined
}

const { slug, title, description, pubDate, updatedDate, heroImage } = Astro.props

const term = `${title} | ${slug}`
---

<BaseLayout title={`${title} | ${SITE_TITLE}`} description={description} image={heroImage}>
  <Header />
  <main>
    <article class="w-full">
      <div class="relative h-[30vh] sm:h-[50vh]">
        {heroImage && <img src={heroImage} alt="" class="h-full w-full object-cover object-center" />}
        <div class="absolute left-0 top-0 h-full w-full items-center justify-end bg-black opacity-50"></div>
        <div
          class="absolute left-0 top-0 flex h-full w-full flex-col justify-end p-4 text-white sm:pb-8 sm:text-center"
        >
          {title && <h1 class="text-2xl sm:text-4xl">{title}</h1>}
          <br />
          {pubDate && <FormattedDate date={pubDate} class="" />}
          {
            updatedDate && (
              <div>
                上次更新于
                <FormattedDate date={updatedDate} class="" />
              </div>
            )
          }
        </div>
      </div>
      <div class="prose mx-auto w-full p-4">
        <div class="mx-auto">
          <slot />
        </div>
        <div class="divider">版权声明</div>
        <p class="mx-auto">
          本页面内容，除特别声明外，均采用 <a
            href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans"
            target="_blank"
            class="link">CC BY-NC-SA 4.0 Deed</a
          > 协议授权。<div class="divider">评论区</div>
          <Comments term={term} client:idle client:only="react" />
        </p>
      </div>
    </article>
    <Footer />
  </main>
</BaseLayout>
